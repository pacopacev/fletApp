name: Minimal Version Bump

on:
  push:
    branches: [ main ]

jobs:
  bump-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Bump version
      run: |
        # Simple version bump using sed
        if [ -f "version.py" ]; then
          CURRENT_VERSION=$(grep -oP "'version': '\K[0-9]+\.[0-9]+\.[0-9]+" version.py)
          IFS='.' read -r major minor patch <<< "$CURRENT_VERSION"
          patch=$((patch + 1))
          NEW_VERSION="$major.$minor.$patch"
          sed -i "s/'version': '[0-9]*\.[0-9]*\.[0-9]*'/'version': '$NEW_VERSION'/" version.py
          echo "Bumped to $NEW_VERSION"
        else
          echo "version='1.0.0'" > version.py
          echo "Created version.py"
        fi
    
    - name: Commit and push
      run: |
        git config user.email "github-actions@users.noreply.github.com"
        git config user.name "GitHub Actions"
        git add version.py
        git commit -m "Bump version" || exit 0
        git push